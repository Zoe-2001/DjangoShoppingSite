<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Site</title>
    {% load static %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <link href="{% static 'store/styles.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'store/base.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'store/hover.css' %}" rel="stylesheet" type="text/css">
    <script src="{% static 'store/list.js' %}" type="text/javascript"></script>

</head>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const categories = document.querySelectorAll(".dropdown-menu a");
        const products = document.querySelectorAll(".product");

        categories.forEach(category => {
            category.addEventListener("click", function (event) {
                event.preventDefault();
                const selectedCategory = this.textContent;

                products.forEach(product => {
                    const productCategory = product.getAttribute("data-category");

                    if (selectedCategory === "All" || selectedCategory === productCategory) {
                        product.style.display = "block";
                    } else {
                        product.style.display = "none";
                    }
                });
            });
        });

        const genderCategories = document.querySelectorAll(".gender a");
        genderCategories.forEach(category => {
            category.addEventListener("click", function (event) {
                event.preventDefault();
                const selectedCategory = this.textContent;

                products.forEach(product => {
                    const productGender = product.getAttribute("data-gender");

                    if (selectedCategory === productGender) {
                        product.style.display = "block";
                    } else {
                        product.style.display = "none";
                    }
                });
            });
        });

        const addToCartButtons = document.querySelectorAll(".add-to-cart-btn");

        addToCartButtons.forEach(button => {
            button.addEventListener("click", function () {
                const productId = this.getAttribute("data-product-id");
                const formData = new FormData();
                formData.append('product_id', productId);

                fetch('{% url "add_to_cart" %}', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data.message);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    });
</script>

<body>
    <header>
        <div class="logo">Shopping Site</div>
        <div class="cart"><a href="{% url 'cart' %}">View Cart</a></div>
         <span><i class="shopping-cart"></i></span>

    </header>
    <nav>
        <ul>
            <ul class="gender">
              <li><a href="#" data-gender="Men">Men</a></li>
              <li><a href="#" data-gender="Women">Women</a></li>
            </ul>
            <li class="dropdown">
                <a href="#">Categories &#9662;</a>
                <ul class="dropdown-menu">
                <li><a href="#" data-category="All">All</a></li>
                <li><a href="#" data-category="Running">Running</a></li>
                <li><a href="#" data-category="Training">Training</a></li>
                <li><a href="#" data-category="Yoga">Yoga</a></li>
                <li><a href="#" data-category="Swimming">Swimming</a></li>
                <li><a href="#" data-category="Cycling">Cycling</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <main>
        {% for product in products %}
        <section class="product" data-product-id="{{ product.id }}" data-category="{{ product.category }}" data-gender="{{ product.gender }}">
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
            <h3>{{ product.name }}</h3>
            <p class="price">${{ product.price }}</p>
            <button class="add-to-cart-btn" data-product-id="{{ product.id }}">Add to Cart</button>
        </section>
        {% endfor %}
    </main>
</body>


</html>